<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Qu·∫£n l√Ω Thu Chi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(to right, #74ebd5, #acb6e5);
      margin: 0;
      padding: 0;
    }
    h1 {
      text-align: center;
      padding: 1.5rem 0;
      color: #fff;
      font-weight: 600;
      font-size: 2rem;
    }
    .container {
      max-width: 720px;
      background: #fff;
      margin: 0 auto;
      padding: 1.5rem;
      border-radius: 15px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }
    form label {
      font-weight: 600;
      display: block;
      margin-top: 1rem;
    }
    form input, form select, form button {
      width: 100%;
      padding: 0.6rem;
      margin-top: 0.3rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
      box-sizing: border-box;
    }
    form button {
      margin-top: 1rem;
      background: #6c63ff;
      color: white;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    form button:hover {
      background: #574b90;
    }
    #filter-month {
      margin: 1rem 0;
      font-weight: 600;
      cursor: pointer;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      border: 1px solid #6c63ff;
      color: #6c63ff;
      width: 100%;
      max-width: 320px;
    }
    .summary {
      text-align: center;
      margin: 1rem 0;
      font-size: 1.1rem;
    }
    .summary span.income {
      color: #28a745;
      font-weight: 700;
    }
    .summary span.expense {
      color: #dc3545;
      font-weight: 700;
    }
    .summary span.balance {
      font-weight: 700;
      font-size: 1.2rem;
    }
    .month-box {
      margin-bottom: 1rem;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
      border: 1px solid #ddd;
    }
    .month-header {
      background-color: #6c63ff;
      color: white;
      padding: 0.8rem 1rem;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
    }
    .month-header span.toggle-icon {
      font-size: 1.2rem;
      transition: transform 0.3s ease;
    }
    .month-header.active span.toggle-icon {
      transform: rotate(180deg);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      display: none;
    }
    table.show {
      display: table;
    }
    th, td {
      padding: 0.6rem 1rem;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #f3f3ff;
      font-weight: 700;
      color: #444;
    }
    tbody tr:nth-child(even) {
      background-color: #fafafa;
    }
    button.delete-btn {
      border: none;
      background-color: #e74c3c;
      color: white;
      padding: 4px 8px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 700;
    }
    button.delete-btn:hover {
      background-color: #c0392b;
    }
  </style>
</head>
<body>
  <h1>üí∞ Qu·∫£n l√Ω Thu Chi C√° Nh√¢n</h1>
  <div class="container">
    <form id="transaction-form">
      <label for="date">Ng√†y:</label>
      <input type="date" id="date" required />
      <label for="type">Lo·∫°i giao d·ªãch:</label>
      <select id="type">
        <option value="income">üíµ Thu</option>
        <option value="expense">üí∏ Chi</option>
      </select>
      <label for="amount">S·ªë ti·ªÅn:</label>
      <input type="number" id="amount" min="0" required />
      <label for="note">Ghi ch√∫:</label>
      <input type="text" id="note" placeholder="V√≠ d·ª•: Mua ƒë·ªì ƒÉn, l∆∞∆°ng, th∆∞·ªüng..." />
      <button type="submit">‚ûï Th√™m giao d·ªãch</button>
    </form>

    <select id="filter-month">
      <option value="">-- T·∫•t c·∫£ c√°c th√°ng --</option>
    </select>

    <div class="summary">
      T·ªïng thu: <span class="income" id="total-income">0</span> ƒë | 
      T·ªïng chi: <span class="expense" id="total-expense">0</span> ƒë | 
      S·ªë d∆∞: <span class="balance" id="balance">0</span> ƒë
    </div>

    <div id="transaction-container"></div>
  </div>

  <script>
    let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');

    // C·∫≠p nh·∫≠t danh s√°ch th√°ng l·ªçc
    function updateMonthFilter() {
      const filter = document.getElementById('filter-month');
      const months = Array.from(new Set(transactions.map(t => t.date.slice(0, 7)))).sort((a,b) => b.localeCompare(a));
      const currentVal = filter.value;

      // X√≥a option c≈© (ngo·∫°i tr·ª´ T·∫•t c·∫£)
      [...filter.options].forEach((opt, i) => {
        if (i > 0) filter.remove(i);
      });

      months.forEach(month => {
        const option = document.createElement('option');
        option.value = month;
        const [year, mon] = month.split('-');
        option.textContent = `Th√°ng ${mon}/${year}`;
        filter.appendChild(option);
      });

      filter.value = currentVal;
    }

    function render() {
      const container = document.getElementById('transaction-container');
      container.innerHTML = '';

      let totalIncome = 0, totalExpense = 0;
      const filterMonth = document.getElementById('filter-month').value;

      // Nh√≥m giao d·ªãch theo th√°ng
      const grouped = {};
      transactions.forEach(t => {
        if (filterMonth && !t.date.startsWith(filterMonth)) return;
        const month = t.date.slice(0, 7);
        if (!grouped[month]) grouped[month] = [];
        grouped[month].push(t);
        if (t.type === 'income') totalIncome += Number(t.amount);
        else totalExpense += Number(t.amount);
      });

      const monthsSorted = Object.keys(grouped).sort((a,b) => b.localeCompare(a));

      monthsSorted.forEach(month => {
        const list = grouped[month];
        const monthBox = document.createElement('div');
        monthBox.className = 'month-box';

        const header = document.createElement('div');
        header.className = 'month-header';
        header.innerHTML = `<span>üìÖ Th√°ng ${month.slice(5,7)}/${month.slice(0,4)} - Thu: ${list.filter(t => t.type==='income').reduce((acc,t) => acc + Number(t.amount),0).toLocaleString()} ƒë, Chi: ${list.filter(t => t.type==='expense').reduce((acc,t) => acc + Number(t.amount),0).toLocaleString()} ƒë</span><span class="toggle-icon">‚ñº</span>`;

        const table = document.createElement('table');
        const thead = document.createElement('thead');
        thead.innerHTML = `<tr><th>Ng√†y</th><th>Lo·∫°i</th><th>S·ªë ti·ªÅn</th><th>Ghi ch√∫</th><th>X√≥a</th></tr>`;
        table.appendChild(thead);

        const tbody = document.createElement('tbody');
        list.sort((a,b) => b.date.localeCompare(a.date)).forEach((t, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${t.date}</td>
            <td>${t.type === 'income' ? 'Thu' : 'Chi'}</td>
            <td>${Number(t.amount).toLocaleString()} ƒë</td>
            <td>${t.note || ''}</td>
            <td><button class="delete-btn" onclick="deleteTransaction('${month}', ${idx})">X</button></td>
          `;
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);

        monthBox.appendChild(header);
        monthBox.appendChild(table);

        header.addEventListener('click', () => {
          const showing = table.classList.toggle('show');
          header.classList.toggle('active', showing);
        });

        container.appendChild(monthBox);
      });

      document.getElementById('total-income').textContent = totalIncome.toLocaleString();
      document.getElementById('total-expense').textContent = totalExpense.toLocaleString();
      document.getElementById('balance').textContent = (totalIncome - totalExpense).toLocaleString();
    }

    // X√≥a giao d·ªãch
    function deleteTransaction(month, indexInMonth) {
      if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a giao d·ªãch n√†y?')) return;

      // L·∫•y danh s√°ch giao d·ªãch c·ªßa th√°ng ƒë√≥
      const list = transactions.filter(t => t.date.startsWith(month));
      const targetTransaction = list[indexInMonth];

      // X√≥a giao d·ªãch trong m·∫£ng transactions (d·ª±a v√†o ng√†y + amount + note + type ƒë·ªÉ ch√≠nh x√°c)
      transactions = transactions.filter(t => !(t.date === targetTransaction.date && t.amount == targetTransaction.amount && t.note === targetTransaction.note && t.type === targetTransaction.type));

      saveAndRender();
    }

    function saveAndRender() {
      localStorage.setItem('transactions', JSON.stringify(transactions));
      updateMonthFilter();
      render();
    }

    document.getElementById('transaction-form').addEventListener('submit', e => {
      e.preventDefault();
      const date = document.getElementById('date').value;
      const type = document.getElementById('type').value;
      const amount = Number(document.getElementById('amount').value);
      const note = document.getElementById('note').value;

      if (!date || !amount) return alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin h·ª£p l·ªá');

      transactions.push({ date, type, amount, note });
      saveAndRender();

      e.target.reset();
    });

    document.getElementById('filter-month').addEventListener('change', () => {
      render();
    });

    // Kh·ªüi t·∫°o
    updateMonthFilter();
    render();
  </script>
</body>
</html>

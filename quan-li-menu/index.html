<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Qu·∫£n L√Ω Menu</title>
  <style>
    body {
      font-family: 'Quicksand', sans-serif;
      background: #f3f4f6;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #d35400;
    }
    .menu-form, .menu-list {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin: 6px 0 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      background: #d35400;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 8px 0;
      border-bottom: 1px dashed #ccc;
      padding: 8px 0;
    }
    .item-name {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>Qu·∫£n L√Ω Menu Qu√°n Nh·ª•y Nguy√™n</h2>

  <div class="menu-form">
    <h3>Th√™m / S·ª≠a M√≥n</h3>
    <input type="hidden" id="item-id" />
    <input type="text" id="item-name" placeholder="T√™n m√≥n ƒÉn" />
    <textarea id="item-desc" placeholder="M√¥ t·∫£ m√≥n"></textarea>
    <input type="number" id="item-price" placeholder="Gi√° (VNƒê)" />
    <input type="text" id="item-img" placeholder="Link h√¨nh ·∫£nh" />
    <select id="item-cat">
      <option value="M√≥n ch√≠nh">M√≥n ch√≠nh</option>
      <option value="Tr√°ng mi·ªáng">Tr√°ng mi·ªáng</option>
      <option value="Th·ª©c u·ªëng">Th·ª©c u·ªëng</option>
    </select>
    <button onclick="saveItem()">üíæ L∆∞u M√≥n</button>
  </div>

  <div class="menu-list">
    <h3>Danh S√°ch M√≥n ƒÇn</h3>
    <div id="menu-items"></div>
  </div>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbxoK36eGkAEfo3470Np90pleBrA62LCBWDYlKRx96Ic-zXJ88_kNy3MXj_rYMiEYHFguA/exec';

    let menu = [];

    async function fetchMenu() {
      const res = await fetch(API_URL + '?action=get');
      const data = await res.json();
      menu = data.menu;
      renderMenu();
    }

    function renderMenu() {
      const container = document.getElementById("menu-items");
      container.innerHTML = "";
      menu.forEach(item => {
        container.innerHTML += `
          <div class="item">
            <div>
              <div class="item-name">${item.name} - ${item.price}ƒë</div>
              <div style="font-size: 13px;">${item.category}</div>
            </div>
            <div>
              <button onclick="editItem('${item.id}')">‚úèÔ∏è</button>
              <button onclick="deleteItem('${item.id}')">üóëÔ∏è</button>
            </div>
          </div>
        `;
      });
    }

    function editItem(id) {
      const item = menu.find(i => i.id === id);
      document.getElementById("item-id").value = item.id;
      document.getElementById("item-name").value = item.name;
      document.getElementById("item-desc").value = item.description;
      document.getElementById("item-price").value = item.price;
      document.getElementById("item-cat").value = item.category;
      document.getElementById("item-img").value = item.image;
    }

    async function saveItem() {
      const id = document.getElementById("item-id").value || Date.now().toString();
      const newItem = {
        id,
        name: document.getElementById("item-name").value,
        description: document.getElementById("item-desc").value,
        price: parseInt(document.getElementById("item-price").value),
        category: document.getElementById("item-cat").value,
        image: document.getElementById("item-img").value
      };

      const index = menu.findIndex(i => i.id === id);
      if (index > -1) {
        menu[index] = newItem;
      } else {
        menu.push(newItem);
      }

      await saveMenu();
      clearForm();
    }

    function clearForm() {
      document.getElementById("item-id").value = "";
      document.getElementById("item-name").value = "";
      document.getElementById("item-desc").value = "";
      document.getElementById("item-price").value = "";
      document.getElementById("item-cat").value = "M√≥n ch√≠nh";
      document.getElementById("item-img").value = "";
    }

    async function deleteItem(id) {
      menu = menu.filter(i => i.id !== id);
      await saveMenu();
    }

    async function saveMenu() {
      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "update", data: menu }),
        headers: { "Content-Type": "application/json" }
      });
      renderMenu();
    }

    fetchMenu();
  </script>
</body>
</html>

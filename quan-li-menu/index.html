<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Qu·∫£n L√Ω Menu</title>
  <style>
   body {
      font-family: 'Quicksand', sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f6f8;
    }
    .container {
      max-width: 480px;
      margin: auto;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #d35400;
    }
    .section {
      background: white;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    input, select, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      margin-bottom: 15px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    .menu-form, .menu-list {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    textarea{
      width: 100%;
      padding: 10px;
      margin: 6px 0 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    
    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 8px 0;
      border-bottom: 1px dashed #ccc;
      padding: 8px 0;
    }
    .item-name {
      font-weight: bold;
    }
    nav {
            display: flex;
            justify-content: center;
            background-color: #d9a382;
            padding: 10px;
        }
        nav a {
            color: white;
            text-decoration: none;
            margin: 0 15px;
            font-size: 18px;
        }
  </style>
  <link rel="manifest" href="../quan-li/manifest.json">
  <meta name="theme-color" content="#4CAF50">
  <script>
  if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('../quan-li/service-worker.js')
    .then(() => console.log('Service Worker registered'))
    .catch(err => console.error('Service Worker registration failed:', err));
}
 navigator.serviceWorker.addEventListener('message', event => {
    if (event.data && event.data.type === 'NEW_VERSION') {
      console.log('C√≥ phi√™n b·∫£n m·ªõi. T·ª± ƒë·ªông t·∫£i l·∫°i...');
      window.location.reload(); 
    }
  });


</script>
</head>
<nav>
    <a href="../quan-li-thu-chi/">Qu·∫£n L√≠ Thu Chi</a>
    <a href="../quan-li-kho/">Qu·∫£n L√≠ Kho</a>
    <a href="../quan-li-menu/">Quan L√≠ Menu</a>
    <a href="../quan-li-nv">Qu·∫£n l√≠ nh√¢n vi√™n</a>
    <a href="../quan-li-sx">Qu·∫£n l√≠ s·∫£n xu·∫•t</a>
    <a href="../quan-li-chi-nhanh/">Qu·∫£n L√≠ Chi Nh√°nh</a>
  </nav>
<body>
  <h2>Qu·∫£n L√Ω Menu Qu√°n Nh·ª•y Nguy√™n</h2>
  <div class="menu-form">
    <h3>Th√™m / S·ª≠a M√≥n</h3>
    <input type="hidden" id="item-id" />
    <input type="text" id="item-name" placeholder="T√™n m√≥n ƒÉn" />
    <textarea id="item-desc" placeholder="M√¥ t·∫£ m√≥n"></textarea>
    <input type="number" id="item-price" placeholder="Gi√° (VNƒê)" />
    <input type="text" id="item-img" placeholder="Link h√¨nh ·∫£nh" />
    <select id="item-cat">
      <option value="M√≥n ch√≠nh">M√≥n ch√≠nh</option>
      <option value="Tr√°ng mi·ªáng">Tr√°ng mi·ªáng</option>
      <option value="Th·ª©c u·ªëng">Th·ª©c u·ªëng</option>
    </select>
    <button onclick="saveItem()">üíæ L∆∞u M√≥n</button>
  </div>

  <div class="menu-list">
    <h3>Danh S√°ch M√≥n ƒÇn</h3>
    <div id="menu-items"></div>
  </div>
<script src="../auth.js"></script>
  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbx4qCbaDl4u6THwmuE8yS5PsWO3o2HJnHUtMuP_JBWOuuLY_rJXWxO-59qWriIFjTMORg/exec';
    let menu = [];
    async function fetchMenu() {
      const res = await fetch(API_URL + '?action=get');
      const data = await res.json();
      menu = data.menu;
      renderMenu();
    }

    function renderMenu() {
      const container = document.getElementById("menu-items");
      container.innerHTML = "";
      menu.forEach(item => {
        container.innerHTML += `
          <div class="item">
            <div>
              <div class="item-name">${item.name} - ${item.price}ƒë</div>
              <div style="font-size: 13px;">${item.category}</div>
            </div>
            <div>
              <button onclick="editItem('${item.id}')">‚úèÔ∏è</button>
              <button onclick="deleteItem('${item.id}')">üóëÔ∏è</button>
            </div>
          </div>
        `;
      });
    }

    function editItem(id) {
      const item = menu.find(i => i.id === id);
      document.getElementById("item-id").value = item.id;
      document.getElementById("item-name").value = item.name;
      document.getElementById("item-desc").value = item.description;
      document.getElementById("item-price").value = item.price;
      document.getElementById("item-cat").value = item.category;
      document.getElementById("item-img").value = item.image;
    }

    async function saveItem() {
      const id = document.getElementById("item-id").value || Date.now().toString();
      const newItem = {
        id,
        name: document.getElementById("item-name").value,
        description: document.getElementById("item-desc").value,
        price: parseInt(document.getElementById("item-price").value),
        category: document.getElementById("item-cat").value,
        image: document.getElementById("item-img").value
      };

      const index = menu.findIndex(i => i.id === id);
      if (index > -1) {
        menu[index] = newItem;
      } else {
        menu.push(newItem);
      }

      await saveMenu();
      clearForm();
    }

    function clearForm() {
      document.getElementById("item-id").value = "";
      document.getElementById("item-name").value = "";
      document.getElementById("item-desc").value = "";
      document.getElementById("item-price").value = "";
      document.getElementById("item-cat").value = "M√≥n ch√≠nh";
      document.getElementById("item-img").value = "";
    }

    async function deleteItem(id) {
      menu = menu.filter(i => i.id !== id);
      await saveMenu();
    }

    async function saveMenu() {
      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({ action: "update", data: menu }),
        mode: "no-cors",
        headers: { "Content-Type": "application/json" }
      });
      renderMenu();
    }

    fetchMenu();
  </script>
</body>
</html>
